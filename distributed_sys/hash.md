## 一致性哈希与哈希槽

哈希，又称散列，不但是一种重要的数据结构，还是一种非常有用的映射函数。在很多语言中，都内置了哈希表这种数据结构，有些语言就算没有内置，也有很多对应的库。各家的实现可能有所不同，或者在侧重点上有不一样的思路，但主要考虑的还是在时间复杂度与空间消耗上的平衡。从数据结构的角度上可以把哈希理解为一种时间复杂度在O(1)到O(logN)之间的快速检索的组织形式。如果把哈希运算看着一种散列映射函数，那哈希算法就是密码学中必不可少的核心功能，密码学的精髓就是验证容易破解难，需要找寻到基本上不能做逆运算的哈希函数，从MD5，sha1，sha2，sha3到椭圆曲线，都是遵循这样的路径。     
这里主要从数据划分和计算划分的角度来描述哈希的用处，换句话说，主要描述哈希在分布式环境中的一些作用与问题。

### 数据与计算如何水平扩展

假如现在有一个为学生服务的程序，一开始没有分布式的架构，就使用一台主机为所有学生服务，好在最初学生不多，就2，3千人，这台主机服务起来没有任何问题。随着学生人数的增多，这台主机逐渐吃不消了。当学生规模达到2，3万的时候，可能还可以通过对主机升级来支撑，假如将原来4核8G的主机替换成32核64G的主机。但如果学生规模继续增长，达到2，3十万的时候，这时基本上找不到一台主流的服务器能够支撑这样的用户规模了。此时，垂直扩展(升级单机硬件和性能)已经走到死胡同了，能解决问题的方向是水平扩展了。水平扩展的意思是通过增加机器数量来提高整个系统的服务能力，理论上机器增加的越多，服务能力就会越强。     

在水平扩展时，我们会遇到第一个问题，那就是数据和计算如何划分，这其实是分布式系统中很有挑战的一个问题，即如何切分任务。比如系统可以简单粗暴地按学生性别划分，按学生年级划分，但这些划分原则都有一个很难克服的问题，那就是划分集通常是固定的，很难扩展。假如我们在用户规模上10万时按性别划分，但如果用户规模继续增长，上到50万后，这种按性别划分的模式就走到头了，划分成男女两组后每台机器还是要服务25万用户，这几乎是做不到的。   

用学号(假定学号对于学生有唯一性)划分是一个不错的选择，那选择怎样的哈希算法是比较合适的。直观上，取模是常用的一种分配数据的方法，假如一开始我们对学号取4的模，那所有的学生都会分配到这4台机器上。随着学生的增加，4台机器可能不够用了，这时需要改进取模的算法，假如我们取模为5，增加一台机器，那最大的问题就是数据的重新平衡。

